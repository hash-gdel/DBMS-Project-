<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MNHS Database Management</title>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

<style>
/* ---------- Variables ---------- */
:root {
    --primary-color: #1abc9c;
    --secondary-color: #16a085;
    --accent-color: #f1c40f;
    --danger-color: #e74c3c;
    --warning-color: #ffc107;
    --light-color: #f9f9f9;
    --dark-color: #2c3e50;
    --border-radius: 16px;
    --box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    --transition: 0.4s ease;
}

/* ---------- Base ---------- */
* { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
body { background: linear-gradient(135deg, #ecf0f1, #d0ece7); color: var(--dark-color); line-height:1.6; min-height:100vh; }
.container { max-width:1200px; margin:0 auto; padding:0 20px; }

/* ---------- Header ---------- */
header { background: var(--primary-color); padding:1rem 0; color:white; box-shadow: var(--box-shadow); }
.header-content { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
header h1 { font-size:2rem; display:flex; align-items:center; gap:10px; }
nav ul { display:flex; list-style:none; gap:20px; margin-top:10px; flex-wrap:wrap; }
nav a { color:white; text-decoration:none; padding:8px 20px; border-radius: var(--border-radius); transition: var(--transition); font-weight:600; }
nav a:hover, nav a.active { background-color: rgba(255,255,255,0.2); }

/* ---------- Dashboard ---------- */
.dashboard { display:grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap:25px; margin-bottom:2rem; margin-top:20px; }
.card { background: linear-gradient(145deg, #ffffff, #e6f7f1); border-radius: var(--border-radius); box-shadow: var(--box-shadow); padding:2rem; text-align:center; position:relative; overflow:hidden; cursor:pointer; transition: var(--transition); }
.card:hover { transform: translateY(-10px) scale(1.03); box-shadow:0 12px 25px rgba(0,0,0,0.25); }
.card i { font-size:3rem; color: var(--primary-color); margin-bottom:15px; }
.card h3 { color: var(--dark-color); margin-bottom:0.8rem; font-size:1.2rem; }
.stat { font-size:2.8rem; font-weight:700; color: var(--secondary-color); }

/* ---------- Sections ---------- */
.section { background:white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); padding:2rem; margin-bottom:2rem; }
.section h2 { color: var(--primary-color); margin-bottom:1.5rem; padding-bottom:0.5rem; border-bottom:3px solid var(--accent-color); }

/* ---------- Tables ---------- */
.table-container { width:100%; margin-top:1rem; overflow-x:auto; background:white; border-radius: var(--border-radius); box-shadow: var(--box-shadow); }
table { width:100%; border-collapse: collapse; }
th, td { padding:0.9rem 1.2rem; text-align:left; border-bottom:1px solid #ddd; transition: var(--transition); }
th { background-color: var(--accent-color); font-weight:600; color: var(--dark-color); position: sticky; top: 0; }
tr:hover { background-color:#dff9f1; }
.status-low { color: var(--danger-color); font-weight:bold; }
.status-missing { color: var(--warning-color); font-weight:bold; }

/* ---------- Tabs ---------- */
.tabs { display:flex; border-bottom:2px solid #ddd; margin-bottom:1rem; flex-wrap:wrap; }
.tab { padding:0.8rem 1.5rem; cursor:pointer; border-bottom:3px solid transparent; transition: var(--transition); font-weight:600; border-radius: var(--border-radius)  var(--border-radius) 0 0; }
.tab.active { border-bottom-color: var(--primary-color); color: var(--primary-color); }
.tab-content, .subtab-content { transition: opacity var(--transition); }
.tab-content:not(.active), .subtab-content:not(.active) { opacity:0; height:0; overflow:hidden; }
.tab-content.active, .subtab-content.active { opacity:1; height:auto; }

/* ---------- Buttons ---------- */
button { padding:10px 20px; background-color: var(--primary-color); color:white; border:none; border-radius: var(--border-radius); cursor:pointer; transition: var(--transition); font-weight:600; }
button:hover { background-color: var(--secondary-color); }

/* ---------- Responsive ---------- */
@media(max-width:768px){
    .header-content{flex-direction:column;gap:15px} 
    nav ul{flex-wrap:wrap; justify-content:center} 
    .dashboard{grid-template-columns:1fr} 
    .tabs{flex-direction:column} 
    .tab{text-align:center} 
    .table-container{display:block; overflow-x:auto;} 
}
</style>
</head>
<body>

<header>
    <div class="container">
        <div class="header-content">
            <div class="logo"><h1><i class="fas fa-hospital"></i> MNHS Dashboard</h1></div>
            <nav>
                <ul>
                    <li><a href="#" class="active" data-tab="dashboard">Dashboard</a></li>
                    <li><a href="#" data-tab="patients">Patients</a></li>
                    <li><a href="#" data-tab="staff">Staff Workload</a></li>
                    <li><a href="#" data-tab="appointments">Appointments</a></li>
                    <li><a href="#" data-tab="medications">Medications</a></li>
                </ul>
            </nav>
        </div>
    </div>
</header>

<main class="container">
    <!-- Dashboard -->
    <section id="dashboard" class="tab-content active">
        <h2>MNHS Dashboard</h2>
        <div class="dashboard">
            <div class="card"><i class="fas fa-calendar-check"></i><h3>Upcoming Appointments</h3><div class="stat" id="stat-appointments">0</div></div>
            <div class="card"><i class="fas fa-user-injured"></i><h3>Active Patients</h3><div class="stat" id="stat-patients">0</div></div>
            <div class="card"><i class="fas fa-user-md"></i><h3>Staff Analyzed</h3><div class="stat" id="stat-staff">0</div></div>
            <div class="card"><i class="fas fa-pills"></i><h3>Low Stock Items</h3><div class="stat" id="stat-lowstock">0</div></div>
        </div>
    </section>

    <!-- Patients -->
    <section id="patients" class="tab-content">
        <h2>Patient Management</h2>
        <div class="tabs">
            <div class="tab active" data-subtab="list-patients">List Patients</div>
            <div class="tab" data-subtab="patient-next-visit">Next Visits</div>
        </div>
        <div id="list-patients" class="subtab-content active">
            <div class="table-container">
                <table>
                    <thead><tr><th>ID</th><th>Full Name</th></tr></thead>
                    <tbody id="patients-body"></tbody>
                </table>
            </div>
        </div>
        <div id="patient-next-visit" class="subtab-content">
            <div class="table-container">
                <table>
                    <thead><tr><th>Patient ID</th><th>Full Name</th><th>Next Appointment</th><th>Department</th><th>Hospital</th></tr></thead>
                    <tbody id="next-visits-body"></tbody>
                </table>
            </div>
        </div>
    </section>

    <!-- Staff Workload -->
    <section id="staff" class="tab-content">
        <h2>Staff Appointment Share </h2>
        <div class="table-container">
            <table>
                <thead>
                    <tr>
                        <th>Staff Name</th>
                        <th>Hospital</th>
                        <th>Total Appts</th>
                        <th>Share %</th>
                    </tr>
                </thead>
                <tbody id="staff-body"></tbody>
            </table>
        </div>
    </section>

    <!-- Appointments -->
    <section id="appointments" class="tab-content">
        <h2>Upcoming Appointments</h2>
        <div class="table-container">
            <table>
                <thead><tr><th>Hospital</th><th>Date</th><th>Scheduled Count</th></tr></thead>
                <tbody id="appointments-body"></tbody>
            </table>
        </div>
    </section>

    <!-- Medications -->
    <section id="medications" class="tab-content">
        <h2>Low Stock Medications</h2>
        <div class="table-container">
            <table>
                <thead><tr><th>Hospital</th><th>Medication</th><th>Current Stock</th><th>Status</th></tr></thead>
                <tbody id="lowstock-body"></tbody>
            </table>
        </div>
    </section>
</main>

<script>
// ---------- Main Tabs ----------
const tabLinks = document.querySelectorAll('nav a[data-tab]');
const tabContents = document.querySelectorAll('.tab-content');

tabLinks.forEach(link => {
    link.addEventListener('click', e => {
        e.preventDefault();
        tabLinks.forEach(l=>l.classList.remove('active'));
        link.classList.add('active');
        const target = link.dataset.tab;
        tabContents.forEach(tc=>tc.classList.remove('active'));
        document.getElementById(target).classList.add('active');

        const subtabs = document.querySelectorAll('#'+target+' .tab');
        const subContents = document.querySelectorAll('#'+target+' .subtab-content');
        if(subtabs.length){
            subtabs.forEach((st,i)=>{st.classList.remove('active'); if(i===0) st.classList.add('active');});
            subContents.forEach((sc,i)=>{sc.classList.remove('active'); if(i===0) sc.classList.add('active');});
        }
    });
});

// ---------- Sub Tabs ----------
document.querySelectorAll('.tabs').forEach(tabContainer=>{
    const tabs = tabContainer.querySelectorAll('.tab');
    tabs.forEach(tab=>{
        tab.addEventListener('click', ()=>{
            tabs.forEach(t=>t.classList.remove('active'));
            tab.classList.add('active');
            const subContents = tabContainer.parentElement.querySelectorAll('.subtab-content');
            subContents.forEach(sc=>sc.classList.remove('active'));
            document.getElementById(tab.dataset.subtab).classList.add('active');
        });
    });
});

// ---------- Fetch data from backend ----------
function fetchData(){
    // Fetch patients
    fetch('/api/patients').then(r=>r.json()).then(data=>{
        const tbody = document.getElementById('patients-body');
        tbody.innerHTML = '';
        data.forEach(p=>{
            tbody.innerHTML += `<tr><td>${p.IID}</td><td>${p.FullName}</td></tr>`;
        });
        document.getElementById('stat-patients').textContent = data.length;
    });

    // Fetch low stock medications
    fetch('/api/low_stock').then(r=>r.json()).then(data=>{
        const tbody = document.getElementById('lowstock-body');
        tbody.innerHTML = '';
        data.forEach(item=>{
            let statusClass = item.Status === 'Missing Stock' ? 'status-missing' : 'status-low';
            tbody.innerHTML += `<tr><td>${item.HospitalName}</td><td>${item.MedicationName}</td><td class="${statusClass}">${item.Qty}</td><td>${item.Status}</td></tr>`;
        });
        document.getElementById('stat-lowstock').textContent = data.length;
    });

    // Fetch appointments - using the correct field names
    fetch('/api/upcoming_appointments').then(r=>r.json()).then(data=>{
        const tbody = document.getElementById('appointments-body');
        tbody.innerHTML = '';
        data.forEach(appointment=>{
            tbody.innerHTML += `<tr>
                <td>${appointment.Hospital || appointment.HospitalName || 'N/A'}</td>
                <td>${appointment.Date || 'N/A'}</td>
                <td>${appointment.ScheduledCount || 'N/A'}</td>
            </tr>`;
        });
        document.getElementById('stat-appointments').textContent = data.length;
    });

    // Fetch next visits
    fetch('/api/next_visits').then(r=>r.json()).then(data=>{
        const tbody = document.getElementById('next-visits-body');
        tbody.innerHTML = '';
        data.forEach(visit=>{
            tbody.innerHTML += `<tr>
                <td>${visit.IID || visit.PatientID || 'N/A'}</td>
                <td>${visit.FullName || 'N/A'}</td>
                <td>${visit.NextAppointment || 'N/A'}</td>
                <td>${visit.Department || 'N/A'}</td>
                <td>${visit.Hospital || visit.HospitalName || 'N/A'}</td>
            </tr>`;
        });
    });

    // Fetch staff data
    fetch('/api/staff_share').then(r=>r.json()).then(data=>{
        const tbody = document.getElementById('staff-body');
        tbody.innerHTML = '';
        data.forEach(row => {
            let share = row.PercentageShare !== null ? parseFloat(row.PercentageShare).toFixed(1) : "0.0";
            tbody.innerHTML += `<tr>
                <td>${row.StaffName}</td>
                <td>${row.HospitalName}</td>
                <td>${row.TotalAppointments}</td>
                <td>${share}%</td>
            </tr>`;
        });
        document.getElementById('stat-staff').textContent = data.length;
    });
}

fetchData();
</script>

</body>
</html>
